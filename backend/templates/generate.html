{% extends "base.html" %}

{% block content %}
<div style="min-height: 100vh; background: white; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 60px 20px;">
    <h1 style="font-size: 2.5rem; font-weight: bold; text-align: center; margin-bottom: 10px;">
        Generate your AI video
    </h1>
    <p style="text-align: center; font-size: 1.1rem; color: #555; max-width: 600px; margin-bottom: 40px;">
        Describe what you want to generate and turn your ideas into stunning AI-generated video clips in minutes.
    </p>

    <form method="post" action="/generate-video" onsubmit="showLoading()" style="width: 100%; max-width: 720px; display: flex; background: #f5f5f5; border-radius: 999px; padding: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.08);">
        <input
            type="text"
            name="prompt"
            placeholder="Describe what you want to generate..."
            style="flex-grow: 1; border: none; background: transparent; font-size: 1rem; padding: 0 20px; outline: none;"
            required
        >
        <button type="submit" class="btn btn-primary" style="border-radius: 999px; padding: 12px 30px; font-weight: bold; font-size: 1rem;">
            Generate
        </button>
    </form>

    <!-- ⏳ Loading Message -->
    <div id="loadingMessage" style="display: none; margin-top: 30px; text-align: center;">
        <div class="spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto;"></div>
        <p style="margin-top: 10px; font-weight: bold;">Please wait while your AI video is generating...</p>
    </div>

    <!-- ✅ Video Output -->
    {% if generated_video_url %}
        <div style="margin-top: 40px; text-align: center;">
            <h3 style="color: green;">✅ AI video generated!</h3>
            <video controls width="640" style="margin-top: 20px; border-radius: 8px;">
                <source src="{{ generated_video_url }}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
    {% elif error %}
        <div style="margin-top: 40px; color: red; font-weight: bold;">
            Error: {{ error }}
        </div>
    {% endif %}

    {% if videos_left is not none and plan_total is not none %}
        <div style="margin-top: 40px; width: 100%; max-width: 600px;">
            <div style="font-weight: bold; margin-bottom: 10px;">
                Video Credits Left: {{ videos_left }}
            </div>
            <div style="width: 100%; height: 12px; background-color: #007bff; border-radius: 8px; overflow: hidden;">
                {% if plan_total > 0 %}
                    {% set percentage = (videos_left / plan_total) * 100 %}
                    <div style="width: {{ percentage }}%; height: 100%; background-color: #007bff;"></div>
                {% else %}
                    <div style="width: 0%; height: 100%; background-color: #007bff;"></div>
                {% endif %}
            </div>
        </div>
    {% endif %}

</div>

<!-- Spinner Animation -->
<style>
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<!-- JS: Show loading spinner -->
<script>
    function showLoading() {
        document.getElementById('loadingMessage').style.display = 'block';
    }
</script>
{% endblock %}
